{% extends "testblock.html" %}
{% load static %}

{% block title %}Danh s√°ch m√¥n h·ªçc - {{ block_info.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'testblock:test_block_list' %}">Kh·ªëi thi</a></li>
      <li class="breadcrumb-item active">{{ block_info.name }}</li>
    </ol>
  </nav>

  <div class="text-center mb-5">
    <h1 class="display-5 fw-bold text-primary">{{ block_info.name }}</h1>
    <p class="lead">Ch·ªçn m√¥n h·ªçc ƒë·ªÉ b·∫Øt ƒë·∫ßu l√†m b√†i test</p>
  </div>

  <div class="row justify-content-center">
    {% for subject in block_info.subjects %}
    <div class="col-lg-4 col-md-6 mb-4">
      <div class="card subject-card h-100 border-0 shadow-lg">
        <div class="card-header bg-primary text-white text-center py-3">
          <i class="fas fa-book fa-2x mb-2"></i>
          <h4 class="card-title mb-0">{{ subject.name }}</h4>
        </div>
        <div class="card-body d-flex flex-column">
          <p class="card-text text-muted text-center mb-3">{{ subject.description }}</p>
          
          <div class="subject-info mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <small><strong>M√£ m√¥n:</strong></small>
              <small class="badge bg-secondary">{{ subject.code }}</small>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <small><strong>S·ªë c√¢u:</strong></small>
              <small>{{ subject.total_questions }} c√¢u</small>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <small><strong>Th·ªùi gian:</strong></small>
              <small>{{ subject.time_limit }} ph√∫t</small>
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <small><strong>H√¨nh th·ª©c:</strong></small>
              <small class="badge bg-info">Tr·∫Øc nghi·ªám</small>
            </div>
          </div>

          <div class="mt-auto">
            <button 
              class="btn btn-success w-100 py-2 fw-bold"
              type="button"
              onclick="startTest('{{ subject.code }}', '{{ subject.name }}', '{{ subject.total_questions }}', '{{ subject.time_limit }}')">
              <i class="fas fa-play-circle me-2"></i>B·∫Øt ƒë·∫ßu l√†m b√†i
            </button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Back button -->
  <div class="text-center mt-5">
    <a href="{% url 'testblock:test_block_list' %}" class="btn btn-outline-primary">
      <i class="fas fa-arrow-left me-2"></i>Quay l·∫°i danh s√°ch kh·ªëi thi
    </a>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function() {
  console.log("‚úÖ subject_test_list.html loaded successfully");
  
  window.startTest = function(subjectCode, subjectName, totalQuestions, timeLimit) {
    const message = `
B·∫ÆT ƒê·∫¶U B√ÄI THI

üìö M√¥n: ${subjectName}
üî¢ M√£ m√¥n: ${subjectCode}
üìù S·ªë c√¢u: ${totalQuestions}
‚è∞ Th·ªùi gian: ${timeLimit} ph√∫t

B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën b·∫Øt ƒë·∫ßu?`;
    
    if (confirm(message)) {
      // L·∫•y block_code t·ª´ URL hi·ªán t·∫°i
      const currentPath = window.location.pathname;
      console.log("Current path:", currentPath);
      
      const blockMatch = currentPath.match(/\/test-khoi\/([^\/]+)\/mon-hoc\/?/);
      
      if (blockMatch && blockMatch[1]) {
        const blockCode = blockMatch[1];
        const url = `/test-khoi/${blockCode}/test/${subjectCode.toLowerCase()}/`;
        console.log("‚û°Ô∏è Chuy·ªÉn h∆∞·ªõng ƒë·∫øn:", url);
        window.location.href = url;
      } else {
        alert("‚ùå Kh√¥ng th·ªÉ x√°c ƒë·ªãnh kh·ªëi thi. Vui l√≤ng th·ª≠ l·∫°i.");
        console.error("Kh√¥ng t√¨m th·∫•y block_code trong URL:", currentPath);
      }
    }
  };

  // Debug info
  console.log("=== DEBUG INFO ===");
  console.log("Block info:", {
    name: "{{ block_info.name }}",
    code: "{{ block_code }}",
    subjects_count: {{ block_info.subjects|length }}
  });
  console.log("=== END DEBUG ===");
});
</script>

<style>
.subject-card {
  border-radius: 15px;
  transition: all 0.3s ease;
  overflow: hidden;
}

.subject-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 15px 35px rgba(0,0,0,0.1);
}

.card-header {
  border-bottom: none;
}

.subject-info {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 10px;
}

.btn-success {
  background: linear-gradient(135deg, #28a745, #20c997);
  border: none;
  border-radius: 10px;
  font-size: 1.1em;
  transition: all 0.3s ease;
}

.btn-success:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
  background: linear-gradient(135deg, #20c997, #28a745);
}

.breadcrumb {
  background: transparent;
  padding: 0;
}

.display-5 {
  font-size: 2.5rem;
}

.badge {
  font-size: 0.8em;
}
</style>
{% endblock %}
<!DOCTYPE html>
<html>
<head>
    <title>{{ title }}</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 30px; }
        .result-card { background: #f8f9fa; padding: 30px; border-radius: 10px; margin-bottom: 30px; }
        .score-circle { width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, #28a745, #20c997); color: white; display: flex; align-items: center; justify-content: center; font-size: 2em; font-weight: bold; margin: 0 auto 20px; }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 30px 0; }
        .stat-item { text-align: center; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .stat-number { font-size: 2em; font-weight: bold; color: #007bff; }
        .stat-label { color: #6c757d; margin-top: 5px; }
        .btn { display: inline-block; padding: 12px 30px; margin: 10px; text-decoration: none; border-radius: 25px; font-weight: bold; transition: all 0.3s ease; border: none; cursor: pointer; }
        .btn-primary { background: linear-gradient(135deg, #007bff, #0056b3); color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-success { background: linear-gradient(135deg, #28a745, #20c997); color: white; }
        .btn-danger { background: linear-gradient(135deg, #dc3545, #c82333); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .performance { margin: 30px 0; }
        .performance-bar { height: 20px; background: #e9ecef; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .performance-fill { height: 100%; background: linear-gradient(135deg, #007bff, #0056b3); }
        .debug-info { background: #fff3cd; padding: 15px; margin: 20px 0; border-radius: 8px; border: 1px solid #ffeaa7; }
        .auto-return { background: #d4edda; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; border: 1px solid #c3e6cb; }
        .countdown { font-size: 1.2em; font-weight: bold; color: #155724; }
        .backup-links { background: #e7f3ff; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; }
        .success-message { background: #d4edda; color: #155724; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; border: 1px solid #c3e6cb; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéâ K·∫øt Qu·∫£ B√†i Test</h1>
            <p>{{ result.subject.name }}</p>
        </div>

        <!-- Th√¥ng b√°o th√†nh c√¥ng -->
        <div class="success-message">
            <i class="fas fa-check-circle"></i>
            <strong>B√†i test ƒë√£ ƒë∆∞·ª£c n·ªôp th√†nh c√¥ng!</strong>
        </div>

        <!-- Th√¥ng b√°o t·ª± ƒë·ªông quay l·∫°i -->
        <div class="auto-return" id="autoReturnMessage">
            <i class="fas fa-clock"></i>
            <span class="countdown" id="countdown">10</span> gi√¢y n·ªØa s·∫Ω t·ª± ƒë·ªông quay l·∫°i danh s√°ch m√¥n h·ªçc...
            <br>
            <small>Nh·∫•n "H·ªßy" ƒë·ªÉ d·ª´ng ƒë·∫øm ng∆∞·ª£c</small>
        </div>

        <div class="result-card">
            <div class="score-circle">
                {{ result.score }}/{{ result.total_questions }}
            </div>
            
            <div style="text-align: center;">
                <h2>ƒêi·ªÉm s·ªë: {{ result.percentage|floatformat:1 }}%</h2>
                <p>Th·ªùi gian l√†m b√†i: {{ result.time_taken }} gi√¢y</p>
                {% if result.user_name %}
                <p><strong>Th√≠ sinh:</strong> {{ result.user_name }}</p>
                {% endif %}
            </div>

            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number">{{ result.score }}</div>
                    <div class="stat-label">C√¢u ƒë√∫ng</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ result.total_questions }}</div>
                    <div class="stat-label">T·ªïng s·ªë c√¢u</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ result.percentage|floatformat:1 }}%</div>
                    <div class="stat-label">T·ª∑ l·ªá ƒë√∫ng</div>
                </div>
            </div>

            <div class="performance">
                <h3>ƒê√°nh gi√° k·∫øt qu·∫£:</h3>
                <div class="performance-bar">
                    <div class="performance-fill" style="width: {{ result.percentage }}%"></div>
                </div>
                <p>
                    {% if result.percentage >= 80 %}
                    <span style="color: #28a745; font-weight: bold;">üéØ Xu·∫•t s·∫Øc! B·∫°n c√≥ ki·∫øn th·ª©c r·∫•t t·ªët.</span>
                    {% elif result.percentage >= 60 %}
                    <span style="color: #007bff; font-weight: bold;">üëç Kh√° t·ªët! Ti·∫øp t·ª•c ph√°t huy.</span>
                    {% elif result.percentage >= 40 %}
                    <span style="color: #ffc107; font-weight: bold;">üí™ C·∫ßn c·ªë g·∫Øng th√™m!</span>
                    {% else %}
                    <span style="color: #dc3545; font-weight: bold;">üìö C·∫ßn √¥n t·∫≠p l·∫°i ki·∫øn th·ª©c.</span>
                    {% endif %}
                </p>
            </div>
        </div>

        <!-- N√öT ƒêI·ªÄU H∆Ø·ªöNG CH√çNH -->
        <div style="text-align: center; margin-top: 30px;">
            <a href="{% url 'testblock:test_block_list' %}" class="btn btn-primary">
                <i class="fas fa-home"></i> V·ªÅ trang ch·ªß test kh·ªëi
            </a>
            
            <a href="{% url 'testblock:subject_test_list' block_code=block_code %}" class="btn btn-secondary" id="backButton">
                <i class="fas fa-arrow-left"></i> Quay l·∫°i danh s√°ch m√¥n h·ªçc
            </a>
            
            <a href="{% url 'testblock:start_subject_test' block_code=block_code subject_code=result.subject.code %}" class="btn btn-success">
                <i class="fas fa-redo"></i> L√†m l·∫°i b√†i n√†y
            </a>

            <button onclick="cancelAutoReturn()" class="btn btn-danger" id="cancelButton">
                <i class="fas fa-times"></i> H·ªßy t·ª± ƒë·ªông quay l·∫°i
            </button>
        </div>

        <!-- DEBUG INFO -->
        <div class="debug-info">
            <h4>üîç DEBUG INFO:</h4>
            <p><strong>Result ID:</strong> {{ result.id }}</p>
            <p><strong>Block Code:</strong> {{ block_code }}</p>
            <p><strong>Subject Code:</strong> {{ result.subject.code }}</p>
            <p><strong>Score:</strong> {{ result.score }}/{{ result.total_questions }}</p>
            <p><strong>Percentage:</strong> {{ result.percentage }}%</p>
        </div>
    </div>

    <script>
        // Bi·∫øn to√†n c·ª•c ƒë·ªÉ ki·ªÉm so√°t ƒë·∫øm ng∆∞·ª£c
        let countdownTimer;
        let countdownValue = 10;
        const countdownElement = document.getElementById('countdown');
        const autoReturnMessage = document.getElementById('autoReturnMessage');
        const backButton = document.getElementById('backButton');

        // H√†m b·∫Øt ƒë·∫ßu ƒë·∫øm ng∆∞·ª£c t·ª± ƒë·ªông quay l·∫°i
        function startAutoReturn() {
            countdownValue = 10;
            countdownElement.textContent = countdownValue;
            
            countdownTimer = setInterval(function() {
                countdownValue--;
                countdownElement.textContent = countdownValue;
                
                if (countdownValue <= 0) {
                    clearInterval(countdownTimer);
                    console.log('üîÑ T·ª± ƒë·ªông chuy·ªÉn h∆∞·ªõng v·ªÅ trang danh s√°ch m√¥n h·ªçc');
                    window.location.href = backButton.href;
                }
            }, 1000);
        }

        // H√†m h·ªßy ƒë·∫øm ng∆∞·ª£c
        function cancelAutoReturn() {
            clearInterval(countdownTimer);
            autoReturnMessage.style.display = 'none';
            
            // Hi·ªÉn th·ªã th√¥ng b√°o ƒë√£ h·ªßy
            const canceledMessage = document.createElement('div');
            canceledMessage.className = 'auto-return';
            canceledMessage.style.background = '#f8d7da';
            canceledMessage.style.borderColor = '#f5c6cb';
            canceledMessage.innerHTML = '<i class="fas fa-info-circle"></i> ƒê√£ h·ªßy t·ª± ƒë·ªông quay l·∫°i. B·∫°n c√≥ th·ªÉ ch·ªçn th·ªß c√¥ng.';
            autoReturnMessage.parentNode.insertBefore(canceledMessage, autoReturnMessage);
        }

        // Khi trang load xong
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ Trang k·∫øt qu·∫£ ƒë√£ load th√†nh c√¥ng');
            console.log('üìä K·∫øt qu·∫£:', {
                'Result ID': '{{ result.id }}',
                'Block Code': '{{ block_code }}',
                'Subject Code': '{{ result.subject.code }}',
                'Score': '{{ result.score }}/{{ result.total_questions }}',
                'Percentage': '{{ result.percentage }}%'
            });
            
            // B·∫Øt ƒë·∫ßu ƒë·∫øm ng∆∞·ª£c t·ª± ƒë·ªông quay l·∫°i
            startAutoReturn();
            
            // ƒê·∫£m b·∫£o n√∫t quay l·∫°i ho·∫°t ƒë·ªông
            backButton.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('üîô Chuy·ªÉn h∆∞·ªõng th·ªß c√¥ng v·ªÅ danh s√°ch m√¥n h·ªçc');
                window.location.href = this.href;
            });
        });

        // X·ª≠ l√Ω ph√≠m t·∫Øt
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                cancelAutoReturn();
            }
        });
    </script>
</body>
</html>

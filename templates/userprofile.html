{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Hồ sơ cá nhân</title>
    {% include 'components/links.html' %}

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        :root { --primary-color: #0072bc; --text-color: #2c384e; --border-color: #e9ecef; --hover-color: #f8f9fa; --card-shadow: 0 5px 25px rgba(0, 0, 0, 0.1); }
        body { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); min-height: 100vh; overflow-x: hidden; }
        .container { display: flex; min-height: 100vh; width: 100%; max-width: 100%; padding: 0; margin: 0; }
        .sidebar { width: 260px; background: white; padding: 24px; display: flex; flex-direction: column; border-right: 1px solid var(--border-color); box-shadow: var(--card-shadow); flex-shrink: 0; }
        .logo { display: flex; align-items: center; gap: 12px; padding: 12px; margin-bottom: 24px; }
        .logo img { width: 40px; height: 40px; }
        .logo span { font-size: 24px; font-weight: 600; color: var(--primary-color); }
        .menu-item { display: flex; align-items: center; gap: 12px; padding: 12px; color: var(--text-color); text-decoration: none; border-radius: 8px; margin-bottom: 8px; transition: all 0.3s ease; width: 100%; cursor: pointer; }
        .menu-item:hover, .menu-item.active { background: rgba(0, 114, 188, 0.1); color: var(--primary-color); transform: translateX(5px); }
        .menu-item i { font-size: 20px; }
        .main-content { flex: 1; padding: 30px; width: calc(100% - 260px); }
        .header { display: flex; justify-content: flex-end; align-items: center; margin-bottom: 30px; background: white; padding: 15px 20px; border-radius: 15px; box-shadow: var(--card-shadow); }
        .data-table-container { background: white; border-radius: 15px; padding: 30px; box-shadow: var(--card-shadow); margin-bottom: 30px; width: 100%; }
        .table-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid var(--border-color); padding-bottom: 20px; position: relative; }
        .table-header:after { content: ''; position: absolute; bottom: -2px; left: 0; width: 60px; height: 2px; background: var(--primary-color); }
        .table-title { font-size: 22px; font-weight: 600; color: var(--primary-color); }
        .avatar-wrapper { width: 120px; height: 120px; border-radius: 50%; overflow: hidden; border: 1px solid #dee2e6; }
        .avatar-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .status-badge { padding: 5px 10px; border-radius: 4px; font-size: 0.85rem; font-weight: 500; display: inline-block; }
        .status-completed {
            background: rgba(34, 197, 94, 0.1);
            color: #22C55E;
        }
        .status-pending {
            background: rgba(255, 193, 7, 0.1);
            color: #FFC107;
        }
        @media (max-width: 992px) { .container { flex-direction: column; } .sidebar { width: 100%; border-right: none; border-bottom: 1px solid var(--border-color); } }

    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar (custom cho trang hồ sơ) -->
        <aside class="sidebar">
            <a class="menu-item" id="menu-home" href="{% url 'index' %}">
                <i class="bi bi-arrow-left"></i>
                <span>Trang chủ</span>
            </a>
            <a class="menu-item active" id="menu-profile" href="#">
                <i class="bi bi-person"></i>
                <span>Thông tin cá nhân</span>
            </a>
            <a class="menu-item" id="menu-appointments" href="#">
                <i class="bi bi-calendar-event"></i>
                <span>Lịch hẹn</span>
            </a>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            {% include 'admin/components/header.html' %}

            <!-- Thông tin cá nhân -->
            <section id="panel-profile" class="data-table-container">
                <div class="table-header">
                    <div class="table-title">Thông tin cá nhân</div>
                </div>

                <div class="d-flex align-items-center gap-3 mb-4">
                    <div class="avatar-wrapper">
                        <img id="avatarPreview" src="{% if member.avatar %}{{ member.avatar.url }}{% else %}{% static 'assets/img/default-avatar.png' %}{% endif %}" alt="Avatar">
                    </div>
                    <div class="fw-semibold">
                        <div>{{ member.first_name }} {{ member.last_name }}</div>
                    </div>
                </div>

                <form method="post" enctype="multipart/form-data" action="">
                    {% csrf_token %}
                    <div class="row g-3 align-items-center mb-3">
                        <div class="col-md-6">
                            <label for="avatar" class="form-label">Hình ảnh</label>
                            <input class="form-control" type="file" id="avatar" name="avatar" accept="image/*">
                            <div class="form-text">Dung lượng tối đa 2MB. Định dạng: JPG, PNG.</div>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="last_name" class="form-label">Họ</label>
                            <input type="text" id="last_name" name="first_name" class="form-control" value="{{ member.first_name }}" placeholder="Nhập họ">
                        </div>
                        <div class="col-md-6">
                            <label for="first_name" class="form-label">Tên</label>
                            <input type="text" id="first_name" name="last_name" class="form-control" value="{{ member.last_name }}" placeholder="Nhập tên">
                        </div>
                        <div class="col-md-6">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" id="email" name="email" class="form-control" value="{{ member.email }}" placeholder="email@domain.com">
                        </div>
                        <div class="col-md-6">
                            <label for="phone" class="form-label">Số điện thoại</label>
                            <input type="text" id="phone" name="phone" class="form-control" value="{{ member.phone_number }}" placeholder="Nhập số điện thoại">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label d-block">Giới tính</label>
                            <div class="d-flex gap-3">
                                {% if member.gender == 'Male' %}
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="gender" id="gender_male" value="Male" checked>
                                    <label class="form-check-label" for="gender_male">Nam</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="gender" id="gender_female" value="Female">
                                    <label class="form-check-label" for="gender_female">Nữ</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="gender" id="gender_other" value="Other">
                                    <label class="form-check-label" for="gender_other">Khác</label>
                                </div>
                                {% elif member.gender == 'Female'%}
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="gender" id="gender_male" value="Male">
                                    <label class="form-check-label" for="gender_male">Nam</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="gender" id="gender_female" value="Female" checked>
                                    <label class="form-check-label" for="gender_female">Nữ</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="gender" id="gender_other" value="Other">
                                    <label class="form-check-label" for="gender_other">Khác</label>
                                </div>
                                {% else %}
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="gender" id="gender_male" value="Male">
                                    <label class="form-check-label" for="gender_male">Nam</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="gender" id="gender_female" value="Female">
                                    <label class="form-check-label" for="gender_female">Nữ</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="gender" id="gender_other" value="Other">
                                    <label class="form-check-label" for="gender_other">Khác</label>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="dob" class="form-label">Ngày sinh</label>
                            <input type="date" id="dob" name="dob" class="form-control" value="{{ member.birthdate|date:'Y-m-d' }}">
                        </div>
                    </div>
                    
                    {% if messages %}
                    <script>
                        const Toast = Swal.mixin({
                            toast: true,
                            position: "top-end",
                            showConfirmButton: false,
                            timer: 3000,  
                            timerProgressBar: true,
                        });
                    {% for message in messages %}
                        Toast.fire({
                            icon: "{{ message.tags }}",
                            title: "{{ message|escapejs }}",
                        });
                    {% endfor %}
                    </script>
                    {% endif %}

                    <div class="mt-4 d-flex gap-2">
                        <button type="submit" class="btn btn-primary"><i class="bi bi-save me-1"></i>Lưu thay đổi</button>
                        <a href="#" class="btn btn-outline-secondary">Hủy</a>
                    </div>
                </form>
            </section>

            <!-- Lịch hẹn -->
            <section id="panel-appointments" class="data-table-container" style="display:none;">
                <div class="table-header">
                    <div class="table-title">Lịch hẹn</div>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th><span title="STT">STT</span></th>
                                <th><span title="Tên chuyên gia">Tên chuyên gia</span></th>
                                <th><span title="Ngày">Ngày</span></th>
                                <th><span title="Thời gian">Thời gian</span></th>
                                <th><span title="Zoom">Zoom</span></th>
                                <th><span title="Trạng thái">Trạng thái</span></th>
                                <th><span title="Hủy">Hủy</span></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for appointment in appointments %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ appointment.work_schedule.expert.first_name }} {{ appointment.work_schedule.expert.last_name }}</td>
                                <td>{{ appointment.work_schedule.date|date:"d/m/Y" }}</td>
                                <td>{{ appointment.work_schedule.work_shift.start_time|time:"H:i" }} - {{ appointment.work_schedule.work_shift.end_time|time:"H:i" }}</td>
                                <td>ID: {{appointment.zoom_room.zoom_id}}/Pass: {{ appointment.zoom_room.password }}</td>
                                <td><span class="status-badge {% if appointment.status == 'N' or appointment.status == 'P' %}status-pending{% else %}status-completed{% endif %}">{% if appointment.status == 'N' %}Chưa thực hiện{% elif appointment.status == 'P' %}Đang thực hiện{% else %}Đã xong{% endif %}</span></td>
                                {% if appointment.status == 'N' %}
                                <td>
                                    <button class="btn btn-sm btn-outline-danger" onclick="return confirm('Bạn có chắc muốn hủy lịch hẹn này?');">Hủy</button>
                                </td>
                                {% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>

    <script src="{% static 'assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/vendor/aos/aos.js' %}"></script>
    <script src="{% static 'assets/vendor/glightbox/js/glightbox.min.js' %}"></script>
    <script src="{% static 'assets/vendor/isotope-layout/isotope.pkgd.min.js' %}"></script>
    <script src="{% static 'assets/vendor/swiper/swiper-bundle.min.js' %}"></script>
    <script src="{% static 'assets/js/main.js' %}"></script>
    <script>
        // Chuyển đổi panel theo sidebar
        const menuProfile = document.getElementById('menu-profile');
        const menuAppointments = document.getElementById('menu-appointments');
        const panelProfile = document.getElementById('panel-profile');
        const panelAppointments = document.getElementById('panel-appointments');

        function setActive(menu) {
            [menuProfile, menuAppointments].forEach(m => m.classList.remove('active'));
            menu.classList.add('active');
        }

        menuProfile.addEventListener('click', function(e) { e.preventDefault(); setActive(menuProfile); panelProfile.style.display = ''; panelAppointments.style.display = 'none'; });
        menuAppointments.addEventListener('click', function(e) { e.preventDefault(); setActive(menuAppointments); panelProfile.style.display = 'none'; panelAppointments.style.display = ''; });

        // Xem trước ảnh đại diện
        const inputAvatar = document.getElementById('avatar');
        const previewImg = document.getElementById('avatarPreview');
        if (inputAvatar) {
            inputAvatar.addEventListener('change', function() {
                const file = this.files && this.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = e => { previewImg.src = e.target.result; };
                reader.readAsDataURL(file);
            });
        }

        // Tự động ẩn sau 3 giây
        setTimeout(() => {
            let alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
            let bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
            });
        }, 3000); // 3000 ms = 3s
    </script>
</body>
</html>



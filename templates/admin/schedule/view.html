  <!DOCTYPE html>
  <html lang="vi">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Đăng ký lịch tư vấn</title>
      {% include 'components/links.html' %}
    <style>
      :root { 
        --primary: var(--accent-color);
        --primary-600: color-mix(in srgb, var(--accent-color), black 15%);
        --bg: var(--background-color);
        --text: var(--default-color);
        --muted: color-mix(in srgb, var(--default-color), transparent 40%);
        --border: color-mix(in srgb, var(--default-color), transparent 90%);
      }
      body { margin:0; font-family: var(--default-font); background:var(--bg); color:var(--text); }
        .container { max-width: 1100px; margin: 24px auto; padding: 0 16px; }
        .header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
      .title { font-size:22px; font-weight:700; color: var(--heading-color); }
        .sub { color:var(--muted); font-size:14px; }
        .card { background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
        .calendar-header { display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid var(--border); }
        .cal-nav { display:flex; gap:8px; align-items:center; }
        .btn { border:1px solid var(--border); background:#fff; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600; }
        .btn:hover { background:#f1f5f9; }
      .btn-primary { background: var(--primary); border-color: var(--primary); color: var(--contrast-color); }
      .btn-primary:hover { background: var(--primary-600); }
        .calendar { padding: 12px; }
        .weekdays, .days { display:grid; grid-template-columns: repeat(7, 1fr); gap:8px; }
        .weekday { text-align:center; font-size:12px; color:var(--muted); padding:6px 0; }
        .day { height:70px; border:1px solid var(--border); border-radius:10px; display:flex; align-items:center; justify-content:center; cursor:pointer; background:#fff; font-weight:600; }
        .day.muted { color:#cbd5e1; cursor:default; background:#fafafa; }
        .day.today { outline:2px solid var(--primary); outline-offset:-2px; }
        .day.selected { background:#e0edff; border-color:#bfdbfe; color:#1e3a8a; }
        .legend { display:flex; gap:12px; align-items:center; padding:0 12px 12px; color:var(--muted); font-size:12px; }
        .dot { width:10px; height:10px; border-radius:999px; display:inline-block; margin-right:6px; }
        .dot-available { background:#22c55e; }
        .dot-full { background:#ef4444; }
        .content { display:grid; grid-template-columns: 1fr 1fr; gap:16px; margin-top:16px; }
        .panel { background:#fff; border:1px solid var(--border); border-radius:12px; padding:16px; }
        .panel h3 { margin:0 0 8px; font-size:16px; }
        .panel small { color:var(--muted); }
        .slots { display:flex; flex-direction:column; gap:8px; margin-top:12px; max-height:420px; overflow:auto; }
        .slot { border:1px solid var(--border); border-radius:10px; padding:12px; display:flex; align-items:center; justify-content:space-between; }
        .slot .time { font-weight:700; }
        .slot .meta { color:var(--muted); font-size:12px; }
        .slot.full { opacity:.5; }
        .slot input[type="radio"] { width:18px; height:18px; cursor:pointer; }
        .actions { display:flex; gap:10px; margin-top:12px; }
        .notice { background:#fef3c7; border:1px solid #fde68a; color:#92400e; padding:10px 12px; border-radius:8px; font-size:14px; }
        @media (max-width: 900px) { .content { grid-template-columns: 1fr; } .day { height:56px; } }
      </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div>
          <div class="title">Đăng ký lịch tư vấn</div>
        </div>
      </div>

      <div class="card">
        <div class="calendar-header">
          <div class="cal-nav">
            <a class="btn" href="?year={{ prev_year }}&month={{ prev_month }}&selected_date={{ selected_date|date:'Y-m-d' }}" aria-label="Tháng trước">◀</a>
            <a class="btn" href="?year={{ selected_date|date:'Y' }}&month={{ selected_date|date:'n' }}&selected_date={{ selected_date|date:'Y-m-d' }}">Hôm nay</a>
            <a class="btn" href="?year={{ next_year }}&month={{ next_month }}&selected_date={{ selected_date|date:'Y-m-d' }}" aria-label="Tháng sau">▶</a>
          </div>
          <div style="font-weight:700">{{ month_label }}</div>
        </div>
        <div class="calendar">
          <div class="weekdays">
            <div class="weekday">T2</div>
            <div class="weekday">T3</div>
            <div class="weekday">T4</div>
            <div class="weekday">T5</div>
            <div class="weekday">T6</div>
            <div class="weekday">T7</div>
            <div class="weekday">CN</div>
          </div>
          <div class="days">
            {% for week in weeks %}
              {% for d in week %}
                {% with d_str=d|date:'Y-m-d' %}
                <a href="?year={{ year }}&month={{ month }}&selected_date={{ d|date:'Y-m-d' }}" class="day {% if d.month != month %}muted{% endif %} {% if d|date:'Y-m-d' == selected_date|date:'Y-m-d' %}selected{% endif %} {% if d|date:'Y-m-d' == now|date:'Y-m-d' %}today{% endif %}">
                  {{ d|date:'j' }}
                </a>
                {% endwith %}
              {% endfor %}
            {% endfor %}
          </div>
        </div>
        <div class="legend">
          <span><span class="dot dot-available"></span>Còn ca</span>
          <span><span class="dot dot-full"></span>Hết ca</span>
        </div>
      </div>

      <form id="scheduleForm" method="post">
        {% csrf_token %}
        <input type="hidden" name="date" value="{{ selected_date|date:'Y-m-d' }}">
        <input type="hidden" name="shift_id" id="shiftIdInput">
      </form>

      <div class="content">
        <div class="panel">
          <h3>Ngày đã chọn</h3>
          <div>{{ selected_date|date:'d/m/Y' }}</div>
          <small>Nhấp vào một ngày để xem các ca.</small>
        </div>
        <div class="panel">
          <h3>Các ca trong ngày</h3>
          <div class="slots">
            {% if work_shifts %}
              {% for shift in work_shifts %}
                {% with is_full=shift.id in booked_shift_ids %}
                <label class="slot{% if is_full %} full{% endif %}">
                  <div>
                    <div class="time">{{ shift.start_time|date:'H:i' }} - {{ shift.end_time|date:'H:i' }}</div>
                    <div class="meta">Mã ca: S{{ shift.id }}{% if is_full %} • Đã đầy{% endif %}</div>
                  </div>
                  <input type="radio" name="slot" value="{{ shift.id }}" {% if is_full %}disabled{% endif %}>
                </label>
                {% endwith %}
              {% endfor %}
            {% else %}
              <div class="sub">Không có ca nào trong ngày này.</div>
            {% endif %}
          </div>
          <div class="actions">
            <button class="btn" type="button" onclick="document.querySelectorAll('input[name=slot]').forEach(r=>r.checked=false);document.getElementById('shiftIdInput').value='';">Bỏ chọn</button>
            <button class="btn btn-primary" type="submit" onclick="var c=document.querySelector('input[name=slot]:checked'); if(!c){alert('Vui lòng chọn một ca.'); return false;} document.getElementById('shiftIdInput').value=c.value;">Xác nhận đăng ký</button>
          </div>
        </div>
      </div>
    </div>
  
  </body>
  </html>
